module.exports=[50529,a=>{"use strict";let b=(0,a.i(12773).registerClientReference)(function(){throw Error("Attempted to call LoanActionsDropdown() from the server but LoanActionsDropdown is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/components/admin/loan-actions-dropdown.tsx <module evaluation>","LoanActionsDropdown");a.s(["LoanActionsDropdown",0,b])},88700,a=>{"use strict";let b=(0,a.i(12773).registerClientReference)(function(){throw Error("Attempted to call LoanActionsDropdown() from the server but LoanActionsDropdown is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/components/admin/loan-actions-dropdown.tsx","LoanActionsDropdown");a.s(["LoanActionsDropdown",0,b])},51261,a=>{"use strict";a.i(50529);var b=a.i(88700);a.n(b)},8661,a=>{"use strict";let b=(0,a.i(12773).registerClientReference)(function(){throw Error("Attempted to call FixLoanStatusButton() from the server but FixLoanStatusButton is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/components/admin/fix-loan-status-button.tsx <module evaluation>","FixLoanStatusButton");a.s(["FixLoanStatusButton",0,b])},99338,a=>{"use strict";let b=(0,a.i(12773).registerClientReference)(function(){throw Error("Attempted to call FixLoanStatusButton() from the server but FixLoanStatusButton is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/components/admin/fix-loan-status-button.tsx","FixLoanStatusButton");a.s(["FixLoanStatusButton",0,b])},35888,a=>{"use strict";a.i(8661);var b=a.i(99338);a.n(b)},14486,a=>{"use strict";var b=a.i(40007),c=a.i(22017),d=a.i(13761),e=a.i(29171),f=a.i(40088),g=a.i(44632),h=a.i(51261),i=a.i(43917),j=a.i(72651),k=a.i(43663),l=a.i(72117),m=a.i(20779),n=a.i(92964),o=a.i(75524),p=a.i(34560),q=a.i(68476);let r=(0,q.default)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),s=(0,q.default)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);var t=a.i(35888);async function u(a){await (0,c.default)();let q=await a.searchParams,u=parseInt(q.page||"1"),v=q.status||"all",w=(u-1)*10,x={};"all"!==v&&(x.status=v);let[y,z]=await Promise.all([d.Loan.find(x).sort({createdAt:-1}).skip(w).limit(10).lean(),d.Loan.countDocuments(x)]),A=Math.ceil(z/10),B=[...new Set(y.map(a=>a.userId))],C=new Map;y.forEach(a=>{a.userName&&a.userEmail&&!C.has(a.userId)&&C.set(a.userId,{userName:a.userName,userEmail:a.userEmail})});let D=await (0,k.clerkClient)(),E=[];try{E=(await D.users.getUserList({limit:500})).data||[]}catch(a){console.error("Failed to fetch Clerk users:",a)}let F=new Map(E.map(a=>[a.id,a])),G=new Map;B.forEach(a=>{let b=F.get(a),c=C.get(a),d="Unknown User",e="";b?(d=b.firstName&&b.lastName?`${b.firstName} ${b.lastName}`:b.username||b.emailAddresses[0]?.emailAddress||"Unknown User",e=b.emailAddresses[0]?.emailAddress||""):c&&(d=c.userName,e=c.userEmail),G.set(a,{userName:d,userEmail:e})});let H=y.map(a=>{let b=G.get(a.userId)||{userName:a.userName||"Unknown User",userEmail:a.userEmail||""};return{id:a._id.toString(),userId:a.userId,userName:b.userName,userEmail:b.userEmail,loanType:a.loanType,amount:a.amount,interestRate:a.interestRate,tenureMonths:a.tenureMonths,emiAmount:a.emiAmount,totalPayable:a.totalPayable,amountPaid:a.amountPaid||0,remainingAmount:a.remainingAmount||a.totalPayable,status:a.status,disbursementAccountId:a.disbursementAccountId?.toString(),rejectionReason:a.rejectionReason,createdAt:a.createdAt.toISOString(),approvedAt:a.approvedAt?.toISOString(),disbursedAt:a.disbursedAt?.toISOString(),rejectedAt:a.rejectedAt?.toISOString()}}),I=(await d.Account.find({status:"active"}).lean()).map(a=>({id:a._id.toString(),userId:a.userId,accountNumber:a.accountNumber,accountType:a.accountType,balance:a.balance,status:a.status})),J=await d.Loan.find({}).lean(),K=J.filter(a=>"pending"===a.status).length,L=J.filter(a=>"approved"===a.status).length,M=J.filter(a=>"active"===a.status).length,N=J.filter(a=>"disbursed"===a.status).length,O=J.filter(a=>"rejected"===a.status).length,P=J.filter(a=>"completed"===a.status).length,Q=J.filter(a=>["disbursed","active","completed","closed"].includes(a.status)).reduce((a,b)=>a+Number(b.amount),0);return(0,b.jsxs)("div",{className:"space-y-6 pb-8",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:"Loan Management"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Review and manage loan applications"})]}),N>0&&(0,b.jsx)(t.FixLoanStatusButton,{})]}),(0,b.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-5",children:[(0,b.jsx)(e.Card,{className:"border-0 shadow-sm",children:(0,b.jsx)(e.CardContent,{className:"p-4",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-lg bg-yellow-500/10",children:(0,b.jsx)(l.Clock,{className:"h-5 w-5 text-yellow-600"})}),(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Pending"}),(0,b.jsx)("p",{className:"text-xl font-bold text-yellow-600",children:K})]})]})})}),(0,b.jsx)(e.Card,{className:"border-0 shadow-sm",children:(0,b.jsx)(e.CardContent,{className:"p-4",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-lg bg-blue-500/10",children:(0,b.jsx)(m.CheckCircle2,{className:"h-5 w-5 text-blue-600"})}),(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Approved"}),(0,b.jsx)("p",{className:"text-xl font-bold text-blue-600",children:L})]})]})})}),(0,b.jsx)(e.Card,{className:"border-0 shadow-sm",children:(0,b.jsx)(e.CardContent,{className:"p-4",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-lg bg-green-500/10",children:(0,b.jsx)(m.CheckCircle2,{className:"h-5 w-5 text-green-600"})}),(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Active"}),(0,b.jsx)("p",{className:"text-xl font-bold text-green-600",children:M})]})]})})}),(0,b.jsx)(e.Card,{className:"border-0 shadow-sm",children:(0,b.jsx)(e.CardContent,{className:"p-4",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-lg bg-red-500/10",children:(0,b.jsx)(n.XCircle,{className:"h-5 w-5 text-red-600"})}),(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Rejected"}),(0,b.jsx)("p",{className:"text-xl font-bold text-red-600",children:O})]})]})})}),(0,b.jsx)(e.Card,{className:"border-0 shadow-sm",children:(0,b.jsx)(e.CardContent,{className:"p-4",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-lg bg-primary/10",children:(0,b.jsx)(p.DollarSign,{className:"h-5 w-5 text-primary"})}),(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Disbursed"}),(0,b.jsx)("p",{className:"text-lg font-bold text-primary truncate",children:(0,g.formatCurrency)(Q)})]})]})})})]}),(0,b.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,b.jsx)(j.default,{href:"/admin/loans?page=1&status=all",children:(0,b.jsxs)(i.Button,{variant:"all"===v?"default":"outline",size:"sm",children:["All (",z,")"]})}),(0,b.jsx)(j.default,{href:"/admin/loans?page=1&status=pending",children:(0,b.jsxs)(i.Button,{variant:"pending"===v?"default":"outline",size:"sm",children:["Pending (",K,")"]})}),(0,b.jsx)(j.default,{href:"/admin/loans?page=1&status=approved",children:(0,b.jsxs)(i.Button,{variant:"approved"===v?"default":"outline",size:"sm",children:["Approved (",L,")"]})}),(0,b.jsx)(j.default,{href:"/admin/loans?page=1&status=active",children:(0,b.jsxs)(i.Button,{variant:"active"===v?"default":"outline",size:"sm",children:["Active (",M,")"]})}),(0,b.jsx)(j.default,{href:"/admin/loans?page=1&status=rejected",children:(0,b.jsxs)(i.Button,{variant:"rejected"===v?"default":"outline",size:"sm",children:["Rejected (",O,")"]})}),(0,b.jsx)(j.default,{href:"/admin/loans?page=1&status=completed",children:(0,b.jsxs)(i.Button,{variant:"completed"===v?"default":"outline",size:"sm",children:["Completed (",P,")"]})})]}),(0,b.jsxs)(e.Card,{className:"border-0 shadow-sm",children:[(0,b.jsxs)(e.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,b.jsx)(e.CardTitle,{children:"all"===v?"All Loans":`${v.charAt(0).toUpperCase()+v.slice(1)} Loans`}),(0,b.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Showing ",w+1,"-",Math.min(w+10,z)," of"," ",z]})]}),(0,b.jsx)(e.CardContent,{className:"p-0",children:H.length>0?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"w-full",children:(0,b.jsx)("div",{className:"max-w-full overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"border-b border-border",children:[(0,b.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground whitespace-nowrap",children:"User"}),(0,b.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground whitespace-nowrap",children:"Type"}),(0,b.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground whitespace-nowrap",children:"Amount"}),(0,b.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground whitespace-nowrap",children:"Rate"}),(0,b.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground whitespace-nowrap",children:"Tenure"}),(0,b.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground whitespace-nowrap",children:"EMI"}),(0,b.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground whitespace-nowrap",children:"Status"}),(0,b.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground whitespace-nowrap",children:"Applied"}),(0,b.jsx)("th",{className:"px-4 py-3 text-right text-xs font-medium text-muted-foreground whitespace-nowrap",children:"Actions"})]})}),(0,b.jsx)("tbody",{className:"divide-y divide-border",children:H.map(a=>(0,b.jsxs)("tr",{className:"hover:bg-muted/50",children:[(0,b.jsx)("td",{className:"px-4 py-3",children:(0,b.jsxs)("div",{className:"flex items-center gap-2 min-w-[180px]",children:[(0,b.jsx)("div",{className:"flex h-8 w-8 shrink-0 items-center justify-center rounded-full bg-primary/10 text-primary font-semibold text-xs",children:a.userName.charAt(0).toUpperCase()}),(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("p",{className:"font-medium text-xs truncate",children:a.userName}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground truncate",children:a.userEmail})]})]})}),(0,b.jsx)("td",{className:"px-4 py-3 text-sm whitespace-nowrap",children:(0,b.jsx)("span",{className:"capitalize",children:a.loanType})}),(0,b.jsx)("td",{className:"px-4 py-3 font-semibold text-sm whitespace-nowrap",children:(0,g.formatCurrency)(Number(a.amount))}),(0,b.jsxs)("td",{className:"px-4 py-3 text-sm whitespace-nowrap",children:[a.interestRate,"%"]}),(0,b.jsxs)("td",{className:"px-4 py-3 text-sm whitespace-nowrap",children:[a.tenureMonths,"m"]}),(0,b.jsx)("td",{className:"px-4 py-3 text-sm whitespace-nowrap",children:(0,g.formatCurrency)(Number(a.emiAmount))}),(0,b.jsx)("td",{className:"px-4 py-3",children:(a=>{switch(a){case"pending":return(0,b.jsxs)(f.Badge,{variant:"secondary",className:"gap-1 whitespace-nowrap",children:[(0,b.jsx)(l.Clock,{className:"h-3 w-3"}),"Pending"]});case"approved":return(0,b.jsxs)(f.Badge,{className:"bg-blue-500 hover:bg-blue-600 gap-1 whitespace-nowrap",children:[(0,b.jsx)(m.CheckCircle2,{className:"h-3 w-3"}),"Approved"]});case"rejected":return(0,b.jsxs)(f.Badge,{variant:"destructive",className:"gap-1 whitespace-nowrap",children:[(0,b.jsx)(n.XCircle,{className:"h-3 w-3"}),"Rejected"]});case"disbursed":case"active":return(0,b.jsxs)(f.Badge,{className:"bg-green-500 hover:bg-green-600 gap-1 whitespace-nowrap",children:[(0,b.jsx)(m.CheckCircle2,{className:"h-3 w-3"}),"Active"]});case"completed":case"closed":return(0,b.jsxs)(f.Badge,{variant:"outline",className:"gap-1 whitespace-nowrap",children:[(0,b.jsx)(m.CheckCircle2,{className:"h-3 w-3"}),"Completed"]});case"defaulted":return(0,b.jsxs)(f.Badge,{variant:"destructive",className:"gap-1 whitespace-nowrap",children:[(0,b.jsx)(o.AlertCircle,{className:"h-3 w-3"}),"Defaulted"]});default:return(0,b.jsx)(f.Badge,{variant:"outline",children:a})}})(a.status)}),(0,b.jsx)("td",{className:"px-4 py-3 text-xs text-muted-foreground whitespace-nowrap",children:(0,g.formatDate)(new Date(a.createdAt))}),(0,b.jsx)("td",{className:"px-4 py-3 text-right",children:(0,b.jsx)(h.LoanActionsDropdown,{loanId:a.id,loanStatus:a.status,userAccounts:I.filter(b=>b.userId===a.userId)})})]},a.id))})]})})}),A>1&&(0,b.jsxs)("div",{className:"px-6 py-4 border-t border-border flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Page ",u," of ",A]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(j.default,{href:`/admin/loans?page=${u-1}${"all"!==v?`&status=${v}`:""}`,children:(0,b.jsxs)(i.Button,{variant:"outline",size:"sm",disabled:1===u,children:[(0,b.jsx)(r,{className:"h-4 w-4 mr-1"}),"Previous"]})}),(0,b.jsx)(j.default,{href:`/admin/loans?page=${u+1}${"all"!==v?`&status=${v}`:""}`,children:(0,b.jsxs)(i.Button,{variant:"outline",size:"sm",disabled:u===A,children:["Next",(0,b.jsx)(s,{className:"h-4 w-4 ml-1"})]})})]})]})]}):(0,b.jsxs)("div",{className:"text-center py-12 px-6 text-muted-foreground",children:["No ","all"!==v?v:""," loan applications yet."]})})]})]})}a.s(["default",()=>u],14486)}];

//# sourceMappingURL=_8ec57d96._.js.map