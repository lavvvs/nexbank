module.exports=[93695,(a,b,c)=>{b.exports=a.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},70864,a=>{a.n(a.i(33290))},43619,a=>{a.n(a.i(79962))},13718,a=>{a.n(a.i(85523))},18198,a=>{a.n(a.i(45518))},62212,a=>{a.n(a.i(66114))},67971,a=>{a.n(a.i(26435))},1269,a=>{"use strict";var b=a.i(717);let c=(...a)=>a.filter((a,b,c)=>!!a&&""!==a.trim()&&c.indexOf(a)===b).join(" ").trim();var d={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let e=(0,b.forwardRef)(({color:a="currentColor",size:e=24,strokeWidth:f=2,absoluteStrokeWidth:g,className:h="",children:i,iconNode:j,...k},l)=>(0,b.createElement)("svg",{ref:l,...d,width:e,height:e,stroke:a,strokeWidth:g?24*Number(f)/Number(e):f,className:c("lucide",h),...k},[...j.map(([a,c])=>(0,b.createElement)(a,c)),...Array.isArray(i)?i:[i]])),f=(a,d)=>{let f=(0,b.forwardRef)(({className:f,...g},h)=>(0,b.createElement)(e,{ref:h,iconNode:d,className:c(`lucide-${a.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,f),...g}));return f.displayName=`${a}`,f};a.s(["default",()=>f],1269)},78500,(a,b,c)=>{b.exports=a.x("node:async_hooks",()=>require("node:async_hooks"))},16477,a=>{"use strict";a.i(48917);var b=a.i(90442),c=a.i(24202),d=a.i(75582),e=a.i(63365);let f=new(a.i(78500)).AsyncLocalStorage;var g=a.i(54772);let h=async()=>{var a,h;let i;try{let a=await (0,c.buildRequestLike)(),d=(0,e.getHeader)(a,b.constants.Headers.ClerkRequestData);i=(0,g.decryptClerkRequestData)(d)}catch(a){if(a&&(0,c.isPrerenderingBailout)(a))throw a}let j=null!=(h=null==(a=f.getStore())?void 0:a.get("requestData"))?h:i;return(null==j?void 0:j.secretKey)||(null==j?void 0:j.publishableKey)?(0,d.createClerkClientWithOptions)(j):(0,d.createClerkClientWithOptions)({})};a.s(["clerkClient",()=>h],16477)},40088,a=>{"use strict";let b,c;var d=a.i(7997),e=a.i(717);function f(a,b){if("function"==typeof a)return a(b);null!=a&&(a.current=b)}var g=e.forwardRef((a,b)=>{let{children:c,...f}=a,g=e.Children.toArray(c),i=g.find(j);if(i){let a=i.props.children,c=g.map(b=>b!==i?b:e.Children.count(a)>1?e.Children.only(null):e.isValidElement(a)?a.props.children:null);return(0,d.jsx)(h,{...f,ref:b,children:e.isValidElement(a)?e.cloneElement(a,void 0,c):null})}return(0,d.jsx)(h,{...f,ref:b,children:c})});g.displayName="Slot";var h=e.forwardRef((a,b)=>{let{children:c,...d}=a;if(e.isValidElement(c)){var g;let a,h,i=(g=c,(h=(a=Object.getOwnPropertyDescriptor(g.props,"ref")?.get)&&"isReactWarning"in a&&a.isReactWarning)?g.ref:(h=(a=Object.getOwnPropertyDescriptor(g,"ref")?.get)&&"isReactWarning"in a&&a.isReactWarning)?g.props.ref:g.props.ref||g.ref);return e.cloneElement(c,{...function(a,b){let c={...b};for(let d in b){let e=a[d],f=b[d];/^on[A-Z]/.test(d)?e&&f?c[d]=(...a)=>{f(...a),e(...a)}:e&&(c[d]=e):"style"===d?c[d]={...e,...f}:"className"===d&&(c[d]=[e,f].filter(Boolean).join(" "))}return{...a,...c}}(d,c.props),ref:b?function(...a){return b=>{let c=!1,d=a.map(a=>{let d=f(a,b);return c||"function"!=typeof d||(c=!0),d});if(c)return()=>{for(let b=0;b<d.length;b++){let c=d[b];"function"==typeof c?c():f(a[b],null)}}}}(b,i):i})}return e.Children.count(c)>1?e.Children.only(null):null});h.displayName="SlotClone";var i=({children:a})=>(0,d.jsx)(d.Fragment,{children:a});function j(a){return e.isValidElement(a)&&a.type===i}var k=a.i(84347);let l=a=>"boolean"==typeof a?`${a}`:0===a?"0":a,m=k.clsx;var n=a.i(82248);let o=(b="inline-flex items-center justify-center rounded-full border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",c={variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}},a=>{var d;if((null==c?void 0:c.variants)==null)return m(b,null==a?void 0:a.class,null==a?void 0:a.className);let{variants:e,defaultVariants:f}=c,g=Object.keys(e).map(b=>{let c=null==a?void 0:a[b],d=null==f?void 0:f[b];if(null===c)return null;let g=l(c)||l(d);return e[b][g]}),h=a&&Object.entries(a).reduce((a,b)=>{let[c,d]=b;return void 0===d||(a[c]=d),a},{});return m(b,g,null==c||null==(d=c.compoundVariants)?void 0:d.reduce((a,b)=>{let{class:c,className:d,...e}=b;return Object.entries(e).every(a=>{let[b,c]=a;return Array.isArray(c)?c.includes({...f,...h}[b]):({...f,...h})[b]===c})?[...a,c,d]:a},[]),null==a?void 0:a.class,null==a?void 0:a.className)});function p({className:a,variant:b,asChild:c=!1,...e}){let f=c?g:"span";return(0,d.jsx)(f,{"data-slot":"badge",className:(0,n.cn)(o({variant:b}),a),...e})}a.s(["Badge",()=>p],40088)},44632,a=>{"use strict";function b(a,c="USD"){return new Intl.NumberFormat("en-US",{style:"currency",currency:c}).format(a)}function c(a){return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric"}).format(new Date(a))}function d(a){return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(new Date(a))}a.s(["formatCurrency",()=>b,"formatDate",()=>c,"formatDateTime",()=>d])},96921,a=>{"use strict";let b=(0,a.i(1269).default)("Landmark",[["line",{x1:"3",x2:"21",y1:"22",y2:"22",key:"j8o0r"}],["line",{x1:"6",x2:"6",y1:"18",y2:"11",key:"10tf0k"}],["line",{x1:"10",x2:"10",y1:"18",y2:"11",key:"54lgf6"}],["line",{x1:"14",x2:"14",y1:"18",y2:"11",key:"380y"}],["line",{x1:"18",x2:"18",y1:"18",y2:"11",key:"1kevvc"}],["polygon",{points:"12 2 20 7 4 7",key:"jkujk7"}]]);a.s(["Landmark",()=>b],96921)},83627,a=>{"use strict";let b=(0,a.i(1269).default)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);a.s(["Users",()=>b],83627)},11070,a=>{"use strict";let b=(0,a.i(1269).default)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);a.s(["DollarSign",()=>b],11070)},36361,a=>{"use strict";let b=(0,a.i(1269).default)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);a.s(["TrendingUp",()=>b],36361)},51111,a=>{"use strict";let b=(0,a.i(11857).registerClientReference)(function(){throw Error("Attempted to call LoanTransactionFilters() from the server but LoanTransactionFilters is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/components/admin/loan-transaction-filters.tsx <module evaluation>","LoanTransactionFilters");a.s(["LoanTransactionFilters",0,b])},59882,a=>{"use strict";let b=(0,a.i(11857).registerClientReference)(function(){throw Error("Attempted to call LoanTransactionFilters() from the server but LoanTransactionFilters is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/components/admin/loan-transaction-filters.tsx","LoanTransactionFilters");a.s(["LoanTransactionFilters",0,b])},7103,a=>{"use strict";a.i(51111);var b=a.i(59882);a.n(b)},89891,a=>{"use strict";var b=a.i(7997);a.i(70396);var c=a.i(73727),d=a.i(5072),e=a.i(16477),f=a.i(22017),g=a.i(13761),h=a.i(29171),i=a.i(40088),j=a.i(44632),k=a.i(7103),l=a.i(96921),m=a.i(36361);let n=(0,a.i(1269).default)("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);var o=a.i(11070),p=a.i(83627);async function q({searchParams:a}){let{userId:q}=await (0,d.auth)();q||(0,c.redirect)("/sign-in"),await (0,f.default)();let r=await g.Profile.findOne({$or:[{userId:q},{clerkId:q}]}).lean();r?.isAdmin||(0,c.redirect)("/dashboard");let s=await a,t=s.type||"all",u=parseInt(s.page||"1"),v=s.search||"",w={};if("emi_payment"===t?w.type="emi_payment":"loan_disbursement"===t?w.type="loan_disbursement":w.type={$in:["loan_disbursement","emi_payment"]},console.log("ðŸ“Š Admin Transactions Query:",JSON.stringify(w,null,2)),v){let a=(await g.Loan.find({$or:[{userName:{$regex:v,$options:"i"}},{userEmail:{$regex:v,$options:"i"}}]}).limit(50).lean()).map(a=>a.userId),b=await (0,e.clerkClient)(),c=[];try{c=(await b.users.getUserList({query:v,limit:50})).data.map(a=>a.id)}catch(a){console.error("Error searching Clerk users:",a)}let d=[...new Set([...a,...c])];w={...w,$or:[{description:{$regex:v,$options:"i"}},{userId:{$in:d}}]}}console.log("Transaction Query:",JSON.stringify(w,null,2));let[x,y]=await Promise.all([g.Transaction.find(w).sort({createdAt:-1}).skip((u-1)*20).limit(20).lean(),g.Transaction.countDocuments(w)]);console.log(`Found ${y} transactions matching query`),console.log("ðŸ“‹ Transaction types in results:",x.map(a=>({type:a.type,desc:a.description})));let z=[...new Set(x.map(a=>a.userId))],A=[...new Set(x.map(a=>a.accountId.toString()))],B=new Map((await g.Account.find({_id:{$in:A}}).lean()).map(a=>[a._id.toString(),a])),C=await g.Loan.find({}).lean(),D=new Map;C.forEach(a=>{a.userName&&a.userEmail&&!D.has(a.userId)&&D.set(a.userId,{userName:a.userName,userEmail:a.userEmail})});let E=await (0,e.clerkClient)(),F=[];try{F=(await E.users.getUserList({limit:500})).data||[]}catch(a){console.error("Failed to fetch Clerk users:",a)}let G=new Map(F.map(a=>[a.id,a])),H=new Map;z.forEach(a=>{let b=G.get(a),c=D.get(a),d="Unknown User",e=null,f=null;b?(d=b.firstName&&b.lastName?`${b.firstName} ${b.lastName}`:b.username||"Unknown User",e=b.emailAddresses[0]?.emailAddress,f=b.imageUrl):c&&(d=c.userName,e=c.userEmail),H.set(a,{name:d,email:e,imageUrl:f})});let I=await g.Transaction.find({type:"loan_disbursement"}).lean(),J=await g.Transaction.find({type:"emi_payment"}).lean(),K=I.reduce((a,b)=>a+b.amount,0),L=J.reduce((a,b)=>a+b.amount,0),M=new Set(I.map(a=>a.userId)).size;console.log("Stats:",{totalDisbursements:I.length,totalRepayments:J.length,totalDisbursed:K,totalRepaid:L});let N=x.map(a=>{let b=B.get(a.accountId.toString()),c=H.get(a.userId)||{name:"Unknown User",email:null,imageUrl:null};return{id:a._id.toString(),userId:a.userId,accountId:a.accountId.toString(),type:a.type,amount:a.amount,description:a.description,status:a.status,createdAt:a.createdAt.toISOString(),accountNumber:b?.accountNumber||"N/A",accountType:b?.accountType||"N/A",userName:c.name,userEmail:c.email,userImage:c.imageUrl}}),O=Math.ceil(y/20);return(0,b.jsxs)("div",{className:"space-y-6 w-full overflow-x-hidden",children:[" ",(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold",children:"Loan Transactions"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Monitor all loan disbursements and EMI repayments"})]}),(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-4",children:[(0,b.jsx)(h.Card,{className:"border-0 shadow-sm",children:(0,b.jsx)(h.CardContent,{className:"p-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Disbursed"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:(0,j.formatCurrency)(K)}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[I.length," disbursements"]})]}),(0,b.jsx)("div",{className:"h-12 w-12 rounded-full bg-blue-100 flex items-center justify-center",children:(0,b.jsx)(n,{className:"h-6 w-6 text-blue-600"})})]})})}),(0,b.jsx)(h.Card,{className:"border-0 shadow-sm",children:(0,b.jsx)(h.CardContent,{className:"p-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Repaid"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-green-600",children:(0,j.formatCurrency)(L)}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[J.length," payments"]})]}),(0,b.jsx)("div",{className:"h-12 w-12 rounded-full bg-green-100 flex items-center justify-center",children:(0,b.jsx)(m.TrendingUp,{className:"h-6 w-6 text-green-600"})})]})})}),(0,b.jsx)(h.Card,{className:"border-0 shadow-sm",children:(0,b.jsx)(h.CardContent,{className:"p-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Outstanding"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-orange-600",children:(0,j.formatCurrency)(K-L)}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Remaining balance"})]}),(0,b.jsx)("div",{className:"h-12 w-12 rounded-full bg-orange-100 flex items-center justify-center",children:(0,b.jsx)(o.DollarSign,{className:"h-6 w-6 text-orange-600"})})]})})}),(0,b.jsx)(h.Card,{className:"border-0 shadow-sm",children:(0,b.jsx)(h.CardContent,{className:"p-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Active Borrowers"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-purple-600",children:M}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Unique users"})]}),(0,b.jsx)("div",{className:"h-12 w-12 rounded-full bg-purple-100 flex items-center justify-center",children:(0,b.jsx)(p.Users,{className:"h-6 w-6 text-purple-600"})})]})})})]}),(0,b.jsx)(k.LoanTransactionFilters,{currentType:t,currentPage:u,totalPages:O,currentSearch:v}),(0,b.jsxs)(h.Card,{className:"border-0 shadow-sm",children:[(0,b.jsx)(h.CardHeader,{children:(0,b.jsxs)(h.CardTitle,{children:["Transaction History",v&&(0,b.jsxs)("span",{className:"text-sm font-normal text-muted-foreground ml-2",children:['- Searching for "',v,'"']})]})}),(0,b.jsxs)(h.CardContent,{className:"p-0 overflow-hidden",children:[" ",0===N.length?(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 px-6",children:[(0,b.jsx)(l.Landmark,{className:"h-16 w-16 text-muted-foreground/50 mb-4"}),(0,b.jsx)("p",{className:"text-lg font-medium",children:"No transactions found"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:v?`No results for "${v}"`:"Try adjusting your filters"})]}):(0,b.jsxs)("div",{className:"w-full overflow-x-auto scrollbar-thin",children:[" ",(0,b.jsxs)("table",{className:"w-full table-fixed divide-y divide-border",children:[" ",(0,b.jsx)("thead",{className:"bg-muted/50",children:(0,b.jsxs)("tr",{className:"border-b",children:[(0,b.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium text-muted-foreground w-[250px]",children:"Borrower"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium text-muted-foreground w-[180px]",children:"Account"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium text-muted-foreground w-[150px]",children:"Type"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium text-muted-foreground w-[250px]",children:"Description"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium text-muted-foreground w-[180px]",children:"Date"}),(0,b.jsx)("th",{className:"px-6 py-3 text-right text-sm font-medium text-muted-foreground w-[150px]",children:"Amount"})]})}),(0,b.jsx)("tbody",{className:"divide-y divide-border bg-white",children:N.map(a=>(0,b.jsxs)("tr",{className:"hover:bg-muted/50",children:[(0,b.jsx)("td",{className:"px-6 py-4",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[a.userImage?(0,b.jsx)("img",{src:a.userImage,alt:a.userName,className:"h-10 w-10 rounded-full flex-shrink-0"}):(0,b.jsx)("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:(0,b.jsx)("span",{className:"text-sm font-medium",children:a.userName.charAt(0)})}),(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("p",{className:"font-medium text-sm whitespace-nowrap",children:a.userName}),a.userEmail&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground whitespace-nowrap",children:a.userEmail})]})]})}),(0,b.jsx)("td",{className:"px-6 py-4",children:(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-mono text-sm whitespace-nowrap",children:a.accountNumber}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground capitalize whitespace-nowrap",children:a.accountType})]})}),(0,b.jsx)("td",{className:"px-6 py-4",children:(0,b.jsx)(i.Badge,{variant:"loan_disbursement"===a.type?"default":"secondary",className:"loan_disbursement"===a.type?"bg-blue-100 text-blue-700 hover:bg-blue-200 whitespace-nowrap":"bg-green-100 text-green-700 hover:bg-green-200 whitespace-nowrap",children:"loan_disbursement"===a.type?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(n,{className:"h-3 w-3 mr-1"}),"Disbursement"]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(m.TrendingUp,{className:"h-3 w-3 mr-1"}),"EMI Payment"]})})}),(0,b.jsx)("td",{className:"px-6 py-4 max-w-[300px]",children:(0,b.jsx)("span",{className:"text-sm truncate block",children:a.description})}),(0,b.jsx)("td",{className:"px-6 py-4",children:(0,b.jsx)("span",{className:"text-sm text-muted-foreground whitespace-nowrap",children:(0,j.formatDateTime)(a.createdAt)})}),(0,b.jsx)("td",{className:"px-6 py-4 text-right",children:(0,b.jsxs)("span",{className:`font-bold text-base whitespace-nowrap ${"loan_disbursement"===a.type?"text-blue-600":"text-green-600"}`,children:["loan_disbursement"===a.type?"-":"+",(0,j.formatCurrency)(a.amount)]})})]},a.id))})]})]})]})]})]})}a.s(["default",()=>q],89891)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__fb343daf._.js.map